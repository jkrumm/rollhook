# StackCommander — Project Configuration

## Project Overview

Self-hosted unified admin suite for solo devs. Replaces Coolify, Doppler, Umami, Sentry, and LaunchDarkly with a single infra container on a VPS.

See: `~/Obsidian/Vault/03_Projects/stackcommander.md`
North Star Stack: `~/Obsidian/Vault/04_Areas/Engineering/north-star-stack.md`

---

## Monorepo Structure

```
stackcommander/
  apps/
    server/          # @stackcommander/server — Elysia unified server (port 7700)
    web/             # @stackcommander/web — TanStack Start frontend (build only)
  packages/
    stackcommander/  # stackcommander — Core shared package
  package.json       # Bun workspace root
  tsconfig.json      # Root TypeScript 6.0 config (inherited by all packages)
  eslint.config.mjs  # @antfu/eslint-config (flat config, handles formatting too)
```

---

## Tech Stack

| Layer | Choice |
|-|-|
| Runtime | Bun 1.3.9 |
| Monorepo | Bun workspaces (native) |
| Language | TypeScript 6.0.0-beta |
| Backend | Elysia (Bun-native, auto-typed routes, hosts frontend) |
| Frontend | TanStack Start v1 (SSR React, file-based routing, served by Elysia) |
| Styling | Tailwind CSS v4 |
| Linting/Formatting | @antfu/eslint-config (ESLint flat config, no Prettier) |

---

## Package Manager

**Bun** — always use `bun` commands.

```bash
# Install all workspace deps from root
bun install

# Add dep to a specific workspace
bun add <pkg> --cwd apps/server
bun add <pkg> --cwd apps/web
bun add <pkg> --cwd packages/stackcommander
```

---

## Scripts

### Root (Bun workspace `--filter`)

| Command | Action |
|-|-|
| `bun run dev` | Start single dev server (Elysia + Vite middleware on port 7700) |
| `bun run build` | Build TanStack Start frontend to `apps/web/dist/` |
| `bun run typecheck` | Type-check all workspaces |
| `bun run lint` | Lint entire monorepo |
| `bun run lint:fix` | Auto-fix lint + formatting |

### Dev (single process)

```bash
bun run dev
# → http://localhost:7700          TanStack Start SSR (via Vite middleware)
# → http://localhost:7700/api/*    Elysia API routes
```

### Prod build + start

```bash
bun run build                                   # builds apps/web/dist/
NODE_ENV=production bun --cwd apps/server run start
# → http://localhost:7700  (static + TanStack Start handler)
```

### Per-workspace

```bash
# Server (apps/server)
bun --cwd apps/server run dev        # Single dev server on port 7700
bun --cwd apps/server run start      # Prod (NODE_ENV=production required)
bun --cwd apps/server run typecheck

# Web (apps/web)
bun --cwd apps/web run build         # Build to dist/ for prod serving
bun --cwd apps/web run typecheck
```

---

## TypeScript

- **Version:** 6.0.0-beta (managed at root, all workspaces inherit)
- **Key defaults in TS6:** `strict: true`, `module: esnext`, `target: es2025`
- `ignoreDeprecations: "6.0"` is set where `baseUrl` is needed (TS6 deprecation)
- `routeTree.gen.ts` in `apps/web/src/` is auto-generated by TanStack Router vite plugin — do not edit manually, run `bun --cwd apps/web run dev` to regenerate

---

## ESLint / Formatting

Uses `@antfu/eslint-config` — handles both linting AND formatting (no Prettier).

```bash
bun run lint        # Check
bun run lint:fix    # Fix + format
```

Config: `eslint.config.mjs` at root — TypeScript + React enabled.

---

## Workspace Package Names

| Directory | Package Name |
|-|-|
| `apps/server` | `@stackcommander/server` |
| `apps/web` | `@stackcommander/web` |
| `packages/stackcommander` | `stackcommander` |

---

## Elysia Server

- Entry: `apps/server/server.ts` (unified server entry)
- API plugin: `apps/server/src/api.ts` (prefix `/api`)
- Runs on port `7700` (dev + prod)
- Dev: wraps Vite in middleware mode + TanStack Start SSR
- Prod: serves `apps/web/dist/client/` static + TanStack Start handler
- Export `App` type for Eden Treaty integration

## TanStack Start Frontend

- Entry: `apps/web/src/router.tsx`
- Server entry: `apps/web/src/server.ts` (SSR handler, loaded by Elysia)
- Routes in `apps/web/src/routes/`
- Vite config: `apps/web/vite.config.ts` (middleware mode only, no standalone server)
- Styles: `apps/web/src/styles.css` (Tailwind v4)

## Eden Treaty (client-side API calls)

```ts
// apps/web/src/client.ts
import { treaty } from '@elysiajs/eden'
import type { App } from '@stackcommander/server'

export const api = treaty<App>('localhost:7700')
```

---

## Git Workflow

Follow SourceRoot conventions (see `~/SourceRoot/CLAUDE.md`):
- `/commit` for conventional commits
- `/pr` for GitHub PR workflow
- No ticket numbers (personal project)
- No AI attribution
